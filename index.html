<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡">
<meta name="theme-color" content="#667eea">
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</title>
<link rel="apple-touch-icon" href="https://i.postimg.cc/7ZrgS8qs/lwjw-bnfsjy-bsyt-%CA%BFn-stwdyw-3.png">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Cairo',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;min-height:100vh}
.container{max-width:1000px;margin:0 auto}
.header{background:white;padding:24px;border-radius:16px;margin-bottom:20px;box-shadow:0 4px 20px rgba(0,0,0,0.15);border:3px solid #4338ca;position:relative;padding-left:140px}
.logo{position:absolute;top:50%;left:20px;transform:translateY(-50%);width:100px;height:100px;object-fit:contain}
.header h1{font-size:26px;color:#4338ca;margin-bottom:16px;text-align:center}
.sync-status{text-align:center;padding:8px;border-radius:8px;font-size:12px;font-weight:700;margin-top:12px}
.sync-online{background:#d1fae5;color:#065f46;border:2px solid #10b981}
.sync-ready{background:#dbeafe;color:#1e40af;border:2px solid #3b82f6}
.sync-saving{background:#fef3c7;color:#92400e;border:2px solid #f59e0b;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
@media (max-width:768px){
.header{padding-left:24px;padding-top:90px}
.logo{width:70px;height:70px;top:15px;left:50%;transform:translateX(-50%)}
.header h1{font-size:20px}
}
.stats-row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.stat-box{background:linear-gradient(135deg,#4338ca,#6366f1);color:white;padding:12px 24px;border-radius:10px;font-weight:700;font-size:15px;box-shadow:0 2px 10px rgba(67,56,202,0.3)}
.grid-layout{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
.card{background:white;padding:24px;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.15);border:3px solid #4338ca}
.card-title{font-size:18px;font-weight:800;color:#4338ca;margin-bottom:20px;padding-bottom:12px;border-bottom:3px solid #e0e7ff;display:flex;align-items:center;gap:8px}
.input-group{margin-bottom:16px}
.input-group label{display:block;font-size:14px;font-weight:700;color:#1f2937;margin-bottom:8px}
.input-group input,.input-group select,.input-group textarea{width:100%;padding:12px 16px;border:2px solid #9ca3af;border-radius:10px;font-size:15px;font-weight:600;font-family:'Cairo',sans-serif;outline:none;transition:all 0.2s}
.input-group input:focus,.input-group select:focus,.input-group textarea:focus{border-color:#4338ca;box-shadow:0 0 0 3px rgba(67,56,202,0.1)}
.input-group textarea{min-height:90px;resize:vertical}
.input-row{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.btn{width:100%;padding:12px 20px;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:8px;font-family:'Cairo',sans-serif}
.btn-primary{background:linear-gradient(135deg,#4338ca,#6366f1);color:white;box-shadow:0 2px 10px rgba(67,56,202,0.3)}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(67,56,202,0.4)}
.btn-success{background:linear-gradient(135deg,#10b981,#059669);color:white}
.btn-success:hover{transform:translateY(-2px)}
.btn-danger{background:linear-gradient(135deg,#ef4444,#dc2626);color:white}
.btn-warning{background:linear-gradient(135deg,#f59e0b,#d97706);color:white}
.btn-outline{background:white;color:#4338ca;border:2px solid #4338ca}
.btn-outline:hover{background:#f5f3ff}
.btn-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:16px}
.search-area{display:flex;gap:10px;margin-bottom:16px}
.search-area input{flex:1;padding:12px 16px;border:2px solid #9ca3af;border-radius:10px;font-size:15px;font-weight:600;outline:none}
.search-area input:focus{border-color:#4338ca}
.results-box{margin-top:20px;padding:16px;background:#f9fafb;border-radius:10px;border:2px solid #d1d5db;max-height:400px;overflow-y:auto}
.result-item{background:white;padding:14px;margin-bottom:10px;border-radius:8px;border:2px solid #e5e7eb;cursor:pointer;transition:all 0.2s}
.result-item:hover{border-color:#4338ca;transform:translateX(-4px);box-shadow:0 2px 10px rgba(67,56,202,0.2)}
.result-name{font-size:16px;font-weight:700;color:#1f2937;margin-bottom:8px}
.result-tags{display:flex;gap:8px;flex-wrap:wrap;font-size:13px}
.tag{padding:4px 12px;border-radius:6px;font-weight:600;border:2px solid}
.tag-success{background:#d1fae5;color:#065f46;border-color:#10b981}
.tag-danger{background:#fee2e2;color:#991b1b;border-color:#ef4444}
.tag-info{background:#e0e7ff;color:#3730a3;border-color:#6366f1}
.empty-msg{text-align:center;padding:40px 20px;color:#6b7280}
.empty-icon{font-size:48px;margin-bottom:12px;opacity:0.5}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(5px);z-index:1000;align-items:center;justify-content:center;padding:20px}
.modal-box{background:white;border-radius:16px;padding:28px;max-width:500px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.3);border:3px solid #4338ca}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:3px solid #e0e7ff}
.modal-title{font-size:20px;font-weight:800;color:#4338ca}
.modal-close{background:#ef4444;color:white;border:none;width:36px;height:36px;border-radius:50%;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
.modal-close:hover{transform:rotate(90deg)}
.alert{padding:16px;border-radius:10px;font-size:15px;font-weight:600;line-height:1.7}
.alert-success{background:#d1fae5;color:#065f46;border-right:4px solid #10b981}
.alert-danger{background:#fee2e2;color:#991b1b;border-right:4px solid #ef4444}
.alert-warning{background:#fef3c7;color:#92400e;border-right:4px solid #f59e0b}
.alert-info{background:#dbeafe;color:#1e40af;border-right:4px solid #3b82f6}
.sync-card{background:linear-gradient(135deg,#3b82f6,#2563eb);color:white;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 15px rgba(59,130,246,0.3);display:none}
.sync-card h3{font-size:18px;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.sync-code{background:rgba(255,255,255,0.2);padding:12px;border-radius:8px;font-family:monospace;font-size:12px;word-break:break-all;margin:10px 0;cursor:pointer;border:2px dashed rgba(255,255,255,0.4);max-height:100px;overflow-y:auto}
.sync-code:hover{background:rgba(255,255,255,0.3)}
@media (max-width:768px){
body{padding:10px}
.grid-layout{grid-template-columns:1fr}
.input-row{grid-template-columns:1fr}
.btn-grid{grid-template-columns:1fr}
.search-area{flex-direction:column}
}
</style>
</head>
<body>
<div class="container">
<div class="sync-card" id="syncCard">
<h3>ğŸ”— Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h3>
<div style="font-size:14px;margin-bottom:10px">Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø£Ø¬Ù‡Ø²ØªÙƒ Ø§Ù„Ø£Ø®Ø±Ù‰:</div>
<div class="sync-code" id="syncCode" onclick="copySyncCode()">Ø§Ù†Ù‚Ø± Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</div>
<div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
<button class="btn btn-success" onclick="generateSyncCode()" style="flex:1;min-width:120px">ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯</button>
<button class="btn btn-outline" onclick="importSyncCode()" style="flex:1;color:white;border-color:white;min-width:120px">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
</div>
</div>
<div class="header">
<img src="https://i.postimg.cc/7ZrgS8qs/lwjw-bnfsjy-bsyt-%CA%BFn-stwdyw-3.png" alt="Logo" class="logo">
<h1>ğŸ—‚ï¸ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h1>
<div class="sync-status sync-ready" id="syncStatus">
<span id="syncText">âœ… Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù‘Ù„</span>
</div>
<div class="stats-row">
<div class="stat-box">ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalCount">0</span></div>
<div class="stat-box">âœ… Ù…ØªÙˆÙØ±: <span id="availableCount">0</span></div>
<div class="stat-box">âŒ Ù†Ø§Ù‚Øµ: <span id="missingCount">0</span></div>
</div>
</div>
<div class="grid-layout">
<div class="card">
<div class="card-title">ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¹Ø±Ø¶</div>
<div class="search-area">
<input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù…...">
<button class="btn btn-primary" id="searchBtn" style="width:auto;padding:12px 24px">Ø¨Ø­Ø«</button>
</div>
<div class="btn-grid">
<button class="btn btn-outline" id="showAllBtn">ğŸ“‹ Ø§Ù„ÙƒÙ„</button>
<button class="btn btn-outline" id="showMissingBtn">âŒ Ù†Ø§Ù‚Øµ</button>
<button class="btn btn-primary" id="syncToggle">ğŸ”— Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</button>
</div>
<div class="results-box" id="resultsBox">
<div class="empty-msg">
<div class="empty-icon">ğŸ”</div>
<div style="font-weight:700">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</div>
</div>
</div>
</div>
<div class="card">
<div class="card-title">âœï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
<div class="input-group">
<label>Ø§Ù„Ø§Ø³Ù…</label>
<input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
</div>
<div class="input-row">
<div class="input-group">
<label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
<input type="number" id="qtyInput" placeholder="0" min="0">
</div>
<div class="input-group">
<label>Ø§Ù„Ø¬Ù†Ø³</label>
<select id="genderInput">
<option value="">Ø§Ø®ØªØ±</option>
<option value="Ø°ÙƒØ±">ğŸ‘¦ Ø°ÙƒØ±</option>
<option value="Ø£Ù†Ø«Ù‰">ğŸ‘§ Ø£Ù†Ø«Ù‰</option>
</select>
</div>
</div>
<div class="input-group">
<label>Ø§Ù„Ù„ÙˆÙ†</label>
<input type="text" id="colorInput" placeholder="Ø§Ù„Ù„ÙˆÙ†">
</div>
<div class="input-group">
<label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
<textarea id="noteInput" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
</div>
<div class="btn-grid">
<button class="btn btn-success" id="addBtn">â• Ø¥Ø¶Ø§ÙØ©</button>
<button class="btn btn-primary" id="updateBtn">âœï¸ ØªØ­Ø¯ÙŠØ«</button>
<button class="btn btn-danger" id="deleteBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
<button class="btn btn-outline" id="clearBtn">ğŸ§¹ Ù…Ø³Ø­</button>
</div>
</div>
<div class="card">
<div class="card-title">ğŸ›’ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹</div>
<div class="input-group">
<label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
<input type="text" id="sellName" placeholder="Ø§Ù„Ø§Ø³Ù…">
</div>
<div class="input-group">
<label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
<input type="number" id="sellQty" placeholder="0" min="1">
</div>
<div class="btn-grid">
<button class="btn btn-warning" id="sellBtn">ğŸ’° Ø¨ÙŠØ¹</button>
<button class="btn btn-outline" id="checkBtn">ğŸ” ÙØ­Øµ</button>
</div>
</div>
<div class="card">
<div class="card-title">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</div>
<div class="btn-grid">
<button class="btn btn-success" id="backupBtn">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
<button class="btn btn-primary" id="restoreBtn">â¬†ï¸ Ø§Ø³ØªØ±Ø¯Ø§Ø¯</button>
<button class="btn btn-outline" id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
<button class="btn btn-outline" id="exportMissingBtn">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø§Ù‚Øµ</button>
</div>
<div id="uploadArea" style="display:none;margin-top:16px;padding:24px;border:3px dashed #9ca3af;border-radius:10px;text-align:center;cursor:pointer;background:#f9fafb">
<div style="font-size:40px;margin-bottom:8px">ğŸ“</div>
<div style="font-weight:700;color:#4b5563">Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù CSV</div>
<input type="file" id="fileInput" accept=".csv" style="display:none">
</div>
</div>
</div>
</div>
<div id="modal" class="modal">
<div class="modal-box">
<div class="modal-header">
<div class="modal-title" id="modalTitle">Ø±Ø³Ø§Ù„Ø©</div>
<button class="modal-close" id="modalClose">Ã—</button>
</div>
<div id="modalBody"></div>
</div>
</div>
<div id="printOptionsModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<div class="modal-title">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</div>
<button class="modal-close" id="printOptionsClose">Ã—</button>
</div>
<div style="margin-bottom:20px">
<div style="font-weight:700;margin-bottom:12px;color:#1f2937">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³:</div>
<div style="display:flex;flex-direction:column;gap:10px">
<label style="padding:12px;border:2px solid #d1d5db;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600">
<input type="radio" name="printGender" value="all" checked style="width:20px;height:20px"><span>Ø§Ù„ÙƒÙ„</span>
</label>
<label style="padding:12px;border:2px solid #d1d5db;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600">
<input type="radio" name="printGender" value="Ø°ÙƒØ±" style="width:20px;height:20px"><span>ğŸ‘¦ Ø°ÙƒÙˆØ± ÙÙ‚Ø·</span>
</label>
<label style="padding:12px;border:2px solid #d1d5db;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600">
<input type="radio" name="printGender" value="Ø£Ù†Ø«Ù‰" style="width:20px;height:20px"><span>ğŸ‘§ Ø¥Ù†Ø§Ø« ÙÙ‚Ø·</span>
</label>
</div>
</div>
<div class="btn-grid">
<button class="btn btn-primary" id="printAllBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒÙ„</button>
<button class="btn btn-outline" id="printMissingBtn">ğŸ“‹ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†Ø§Ù‚Øµ</button>
</div>
</div>
</div>
<script>
var STORAGE_KEY = 'names_db_final';
var db = [];

function loadDB() {
  try {
    var stored = localStorage.getItem(STORAGE_KEY);
    db = stored ? JSON.parse(stored) : [];
  } catch(e) {
    db = [];
  }
  if (db.length === 0) {
    db = [
      {name: 'Ø®Ø§Ù„Ø¯', gender: 'Ø°ÙƒØ±', qty: 25, color: 'Ø£Ø²Ø±Ù‚', note: 'Ù…Ù‚Ø§Ø³ ØµØºÙŠØ±'},
      {name: 'Ø®Ø§Ù„Ø¯Ø©', gender: 'Ø£Ù†Ø«Ù‰', qty: 10, color: 'Ø£Ø­Ù…Ø±', note: 'Ù…Ø®ØµØµØ©'},
      {name: 'Ø£Ø­Ù…Ø¯', gender: 'Ø°ÙƒØ±', qty: 0, color: 'Ø£Ø®Ø¶Ø±', note: 'Ù†Ø§Ù‚Øµ'}
    ];
    saveDB();
  }
}

function saveDB() {
  try {
    var st = document.getElementById('syncStatus');
    var tx = document.getElementById('syncText');
    st.className = 'sync-status sync-saving';
    tx.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
    localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
    updateStats();
    setTimeout(function() {
      st.className = 'sync-status sync-online';
      tx.textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§';
    }, 500);
    setTimeout(function() {
      st.className = 'sync-status sync-ready';
      tx.textContent = 'Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„';
    }, 2000);
  } catch(e) {
    alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸');
  }
}

function updateStats() {
  document.getElementById('totalCount').textContent = db.length;
  document.getElementById('availableCount').textContent = db.filter(function(i) { return i.qty > 0; }).length;
  document.getElementById('missingCount').textContent = db.filter(function(i) { return i.qty === 0; }).length;
}

function generateSyncCode() {
  var code = btoa(unescape(encodeURIComponent(JSON.stringify(db))));
  document.getElementById('syncCode').textContent = code;
  document.getElementById('syncCard').style.display = 'block';
  showModal('ØªÙ…', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'success');
}

function copySyncCode() {
  var code = document.getElementById('syncCode').textContent;
  if (code === 'Ø§Ù†Ù‚Ø± Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©') return generateSyncCode();
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(code).then(function() {
      showModal('ØªÙ… Ø§Ù„Ù†Ø³Ø®', 'Ø§Ù„ÙƒÙˆØ¯ Ù…Ù†Ø³ÙˆØ®', 'success');
    }).catch(function() {
      prompt('Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯:', code);
    });
  } else {
    prompt('Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯:', code);
  }
}

function importSyncCode() {
  var code = prompt('Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù‡Ù†Ø§:');
  if (!code) return;
  try {
    var importedDB = JSON.parse(decodeURIComponent(escape(atob(code))));
    if (!Array.isArray(importedDB)) throw new Error('Invalid');
    if (confirm('Ø§Ø³ØªÙŠØ±Ø§Ø¯ ' + importedDB.length + ' Ø³Ø¬Ù„ØŸ')) {
      db = importedDB;
      saveDB();
      showResults(db, 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
      showModal('Ù†Ø¬Ø­', 'ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
    }
  } catch(e) {
    showModal('Ø®Ø·Ø£', 'ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
  }
}

function showResults(items, title) {
  var box = document.getElementById('resultsBox');
  if (items.length === 0) {
    box.innerHTML = '<div class="empty-msg"><div class="empty-icon">âŒ</div><div style="font-weight:700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div>';
    return;
  }
  var html = '';
  if (title) html += '<div style="font-weight:800;color:#4338ca;margin-bottom:12px">' + title + '</div>';
  for (var i = 0; i < items.length; i++) {
    var item = items[i];
    var qtyTag = item.qty === 0 ? '<span class="tag tag-danger">Ù†Ø§Ù‚Øµ</span>' : '<span class="tag tag-success">' + item.qty + '</span>';
    html += '<div class="result-item" onclick="fillForm(\'' + item.name.replace(/'/g, "\\'") + '\')">';
    html += '<div class="result-name">' + (i + 1) + '. ' + item.name + '</div>';
    html += '<div class="result-tags">' + qtyTag;
    html += '<span class="tag tag-info">' + (item.gender || '-') + '</span>';
    html += '<span class="tag tag-info">' + (item.color || '-') + '</span>';
    if (item.note) html += '<span class="tag tag-info">' + item.note + '</span>';
    html += '</div></div>';
  }
  box.innerHTML = html;
}

function fillForm(name) {
  for (var i = 0; i < db.length; i++) {
    if (db[i].name.toLowerCase() === name.toLowerCase()) {
      document.getElementById('nameInput').value = db[i].name;
      document.getElementById('qtyInput').value = db[i].qty;
      document.getElementById('genderInput').value = db[i].gender || '';
      document.getElementById('colorInput').value = db[i].color || '';
      document.getElementById('noteInput').value = db[i].note || '';
      showModal('ØªÙ…', 'ØªÙ… ØªØ¹Ø¨Ø¦Ø©: ' + db[i].name, 'success');
      break;
    }
  }
}

function showModal(title, msg, type) {
  document.getElementById('modalTitle').textContent = title;
  var cls = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-danger' : type === 'warning' ? 'alert-warning' : 'alert-info';
  document.getElementById('modalBody').innerHTML = '<div class="alert ' + cls + '">' + msg + '</div>';
  document.getElementById('modal').style.display = 'flex';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

document.getElementById('syncToggle').addEventListener('click', function() {
  var card = document.getElementById('syncCard');
  card.style.display = card.style.display === 'none' ? 'block' : 'none';
});

document.getElementById('searchBtn').addEventListener('click', function() {
  var q = document.getElementById('searchInput').value.trim().toLowerCase();
  if (!q) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ù†Øµ Ù„Ù„Ø¨Ø­Ø«', 'warning');
  var results = [];
  for (var i = 0; i < db.length; i++) {
    if (db[i].name.toLowerCase().indexOf(q) !== -1) results.push(db[i]);
  }
  showResults(results, 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (' + results.length + ')');
});

document.getElementById('searchInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') document.getElementById('searchBtn').click();
});

document.getElementById('showAllBtn').addEventListener('click', function() {
  showResults(db, 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª (' + db.length + ')');
});

document.getElementById('showMissingBtn').addEventListener('click', function() {
  var missing = [];
  for (var i = 0; i < db.length; i++) {
    if (db[i].qty === 0) missing.push(db[i]);
  }
  showResults(missing, 'Ø§Ù„Ù†Ø§Ù‚Øµ (' + missing.length + ')');
});

document.getElementById('addBtn').addEventListener('click', function() {
  var name = document.getElementById('nameInput').value.trim();
  var gender = document.getElementById('genderInput').value;
  if (!name) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
  if (!gender) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³', 'warning');
  for (var i = 0; i < db.length; i++) {
    if (db[i].name.toLowerCase() === name.toLowerCase()) {
      return showModal('Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§', 'warning');
    }
  }
  db.push({
    name: name,
    qty: parseInt(document.getElementById('qtyInput').value) || 0,
    gender: gender,
    color: document.getElementById('colorInput').value.trim(),
    note: document.getElementById('noteInput').value.trim()
  });
  saveDB();
  showModal('Ù†Ø¬Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ©: ' + name, 'success');
  document.getElementById('clearBtn').click();
  showResults(db, 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

document.getElementById('updateBtn').addEventListener('click', function() {
  var name = document.getElementById('nameInput').value.trim();
  if (!name) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
  var idx = -1;
  for (var i = 0; i < db.length; i++) {
    if (db[i].name.toLowerCase() === name.toLowerCase()) {
      idx = i;
      break;
    }
  }
  if (idx === -1) return showModal('ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
  var gender = document.getElementById('genderInput').value;
  if (!gender) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³', 'warning');
  db[idx] = {
    name: name,
    qty: parseInt(document.getElementById('qtyInput').value) || 0,
    gender: gender,
    color: document.getElementById('colorInput').value.trim(),
    note: document.getElementById('noteInput').value.trim()
  };
  saveDB();
  showModal('Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ø¯ÙŠØ«: ' + name, 'success');
  showResults(db, 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

document.getElementById('deleteBtn').addEventListener('click', function() {
  var name = document.getElementById('nameInput').value.trim();
  if (!name) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
  var idx = -1;
  for (var i = 0; i < db.length; i++) {
    if (db[i].name.toLowerCase() === name.toLowerCase()) {
      idx = i;
      break;
    }
  }
  if (idx === -1) return showModal('ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
  if (!confirm('Ø­Ø°Ù "' + name + '"ØŸ')) return;
  db.splice(idx, 1);
  saveDB();
  showModal('Ù†Ø¬Ø­', 'ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
  document.getElementById('clearBtn').click();
  showResults(db, 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

document.getElementById('clearBtn').addEventListener('click', function() {
  document.getElementById('nameInput').value = '';
  document.getElementById('qtyInput').value = '';
  document.getElementById('genderInput').value = '';
  document.getElementById('colorInput').value = '';
  document.getElementById('noteInput').value = '';
});

document.getElementById('checkBtn').addEventListener('click', function() {
  var name = document.getElementById('sellName').value.trim();
  if (!name) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
  var item = null;
  for (var i = 0; i < db.length; i++) {
    if (db[i].name.toLowerCase() === name.toLowerCase()) {
      item = db[i];
      break;
    }
  }
  if (!item) return showModal('ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
  var status = item.qty === 0 ? 'ØºÙŠØ± Ù…ØªÙˆÙØ±' : 'Ù…ØªÙˆÙØ± (' + item.qty + ')';
  showModal('Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', item.name + ': ' + status, 'info');
});

document.getElementById('sellBtn').addEventListener('click', function() {
  var name = document.getElementById('sellName').value.trim();
  var qty = parseInt(document.getElementById('sellQty').value) || 0;
  if (!name) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
  if (qty <= 0) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©', 'warning');
  var idx = -1;
  for (var i = 0; i < db.length; i++) {
    if (db[i].name.toLowerCase() === name.toLowerCase()) {
      idx = i;
      break;
    }
  }
  if (idx === -1) return showModal('ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
  if (db[idx].qty < qty) return showModal('ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©', 'Ø§Ù„Ù…ØªØ§Ø­: ' + db[idx].qty, 'error');
  if (!confirm('Ø¨ÙŠØ¹ ' + qty + ' Ù…Ù† "' + name + '"ØŸ')) return;
  db[idx].qty -= qty;
  saveDB();
  showModal('ØªÙ… Ø§Ù„Ø¨ÙŠØ¹', 'Ø§Ù„Ù…Ø¨Ø§Ø¹: ' + qty + ' - Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ' + db[idx].qty, 'success');
  document.getElementById('sellName').value = '';
  document.getElementById('sellQty').value = '';
});

document.getElementById('backupBtn').addEventListener('click', function() {
  if (db.length === 0) return showModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
  var csv = '\ufeffØ§Ù„Ø§Ø³Ù…,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„Ø¬Ù†Ø³,Ø§Ù„Ù„ÙˆÙ†,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
  for (var i = 0; i < db.length; i++) {
    var item = db[i];
    csv += item.name + ',' + item.qty + ',' + (item.gender || '') + ',' + (item.color || '') + ',"' + (item.note || '') + '"\n';
  }
  var blob = new Blob([csv], {type: 'text/csv;charset=utf-8'});
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = 'backup_' + new Date().toISOString().split('T')[0] + '.csv';
  a.click();
  URL.revokeObjectURL(url);
  showModal('Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + db.length + ' Ø³Ø¬Ù„', 'success');
});

document.getElementById('exportMissingBtn').addEventListener('click', function() {
  var missing = [];
  for (var i = 0; i < db.length; i++) {
    if (db[i].qty === 0) missing.push(db[i]);
  }
  if (missing.length === 0) return showModal('Ù„Ø§ ÙŠÙˆØ¬Ø¯', 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…ØªÙˆÙØ±Ø©', 'success');
  var csv = '\ufeffØ§Ù„Ø§Ø³Ù…,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„Ø¬Ù†Ø³,Ø§Ù„Ù„ÙˆÙ†,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
  for (var i = 0; i < missing.length; i++) {
    var item = missing[i];
    csv += item.name + ',' + item.qty + ',' + (item.gender || '') + ',' + (item.color || '') + ',"' + (item.note || '') + '"\n';
  }
  var blob = new Blob([csv], {type: 'text/csv;charset=utf-8'});
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = 'missing_' + new Date().toISOString().split('T')[0] + '.csv';
  a.click();
  URL.revokeObjectURL(url);
  showModal('Ù†Ø¬Ø­', 'ØªÙ… ØªØµØ¯ÙŠØ± ' + missing.length + ' Ø³Ø¬Ù„ Ù†Ø§Ù‚Øµ', 'success');
});

document.getElementById('printBtn').addEventListener('click', function() {
  document.getElementById('printOptionsModal').style.display = 'flex';
});

document.getElementById('printOptionsClose').addEventListener('click', function() {
  document.getElementById('printOptionsModal').style.display = 'none';
});

document.getElementById('printAllBtn').addEventListener('click', function() {
  var gender = document.querySelector('input[name="printGender"]:checked').value;
  var items = gender === 'all' ? db : db.filter(function(i) { return i.gender === gender; });
  if (items.length === 0) return showModal('Ù„Ø§ ÙŠÙˆØ¬Ø¯', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª', 'warning');
  printItems(items, 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª' + (gender !== 'all' ? ' - ' + gender : ''));
});

document.getElementById('printMissingBtn').addEventListener('click', function() {
  var gender = document.querySelector('input[name="printGender"]:checked').value;
  var items = db.filter(function(i) { return i.qty === 0; });
  if (gender !== 'all') items = items.filter(function(i) { return i.gender === gender; });
  if (items.length === 0) return showModal('Ù„Ø§ ÙŠÙˆØ¬Ø¯', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù†Ø§Ù‚ØµØ©', 'warning');
  printItems(items, 'Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©' + (gender !== 'all' ? ' - ' + gender : ''));
});

function printItems(items, title) {
  var pw = window.open('', '_blank');
  if (!pw) return showModal('Ø®Ø·Ø£', 'ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙØªØ­ Ø§Ù„Ù†ÙˆØ§ÙØ°', 'error');
  var html = '<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>' + title + '</title>';
  html += '<style>body{font-family:Arial;padding:20px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #000;padding:8px;text-align:center}th{background:#4338ca;color:white}</style>';
  html += '</head><body><h1 style="text-align:center">' + title + '</h1><table><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¬Ù†Ø³</th><th>Ø§Ù„Ù„ÙˆÙ†</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>';
  for (var i = 0; i < items.length; i++) {
    var item = items[i];
    html += '<tr><td>' + (i + 1) + '</td><td>' + item.name + '</td><td>' + item.qty + '</td><td>' + (item.gender || '-') + '</td><td>' + (item.color || '-') + '</td><td>' + (item.note || '-') + '</td></tr>';
  }
  html += '</table><script>window.onload=function(){setTimeout(function(){window.print()},500)};</script></body></html>';
  pw.document.open();
  pw.document.write(html);
  pw.document.close();
  document.getElementById('printOptionsModal').style.display = 'none';
}

document.getElementById('restoreBtn').addEventListener('click', function() {
  document.getElementById('uploadArea').style.display = 'block';
  document.getElementById('fileInput').click();
});

document.getElementById('uploadArea').addEventListener('click', function() {
  document.getElementById('fileInput').click();
});

document.getElementById('fileInput').addEventListener('change', function(e) {
  var file = e.target.files[0];
  if (!file) return;
  if (!file.name.endsWith('.csv')) return showModal('Ø®Ø·Ø£', 'Ø§Ø®ØªØ± Ù…Ù„Ù CSV ÙÙ‚Ø·', 'error');
  var reader = new FileReader();
  reader.onload = function(event) {
    try {
      var content = event.target.result;
      var lines = content.split('\n').filter(function(l) { return l.trim(); });
      if (lines.length < 2) return showModal('Ø®Ø·Ø£', 'Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº', 'error');
      var newDB = [];
      for (var i = 1; i < lines.length; i++) {
        var parts = lines[i].split(',');
        if (parts.length >= 3) {
          var name = parts[0].trim();
          var qty = parseInt(parts[1]) || 0;
          var gender = parts[2].trim();
          var color = parts[3] ? parts[3].trim() : '';
          var note = parts[4] ? parts[4].replace(/^"|"$/g, '').trim() : '';
          if (name) newDB.push({name: name, qty: qty, gender: gender, color: color, note: note});
        }
      }
      if (newDB.length === 0) return showModal('Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
      if (confirm('Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ' + db.length + ' Ø³Ø¬Ù„ Ø¨Ù€ ' + newDB.length + ' Ø³Ø¬Ù„ØŸ')) {
        db = newDB;
        saveDB();
        showResults(db, 'ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯');
        document.getElementById('uploadArea').style.display = 'none';
        showModal('Ù†Ø¬Ø­', 'ØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ ' + newDB.length + ' Ø³Ø¬Ù„', 'success');
      }
    } catch(error) {
      showModal('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
    }
  };
  reader.readAsText(file);
  e.target.value = '';
});

document.getElementById('modalClose').addEventListener('click', closeModal);
document.getElementById('modal').addEventListener('click', function(e) {
  if (e.target === document.getElementById('modal')) closeModal();
});

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeModal();
});

loadDB();
updateStats();
console.log('Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø§Ù‡Ø² -', db.length, 'Ø³Ø¬Ù„');
</script>
</body>
</html>
